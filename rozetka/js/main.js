var BigPromoEffect_class=new Class({Class:'BigPromoEffect_class',options:{css:{prev:'prev',active:'active',next:'next',no_animations_control:'promo-compact'},css_properties:['top','width','display'],_display:{property:'display',hide:'none',show:'inline'},_zIndex:{property:'z-index',front:3,middle:2,back:1},duration:500,min_elements_count:3,previews_opacity:0.5,fx:{active:{zIndex:2,opacity:1.0},prev:{zIndex:1},next:{zIndex:1},other:{zIndex:0,opacity:0}}},_banner_place:null,_elements:null,_elements_length:0,_index:0,_allow_animation:true,_refresh_timeout_point:null,_refresh_timeout_time:500,_is_run:false,initialize:function(elements,current_index,banner_place,options){this.setOptions(options);this.options.fx.prev.opacity=this.options.previews_opacity;this.options.fx.next.opacity=this.options.previews_opacity;this._elements=elements;this._elements_length=this._elements.length;if(current_index){this._index=current_index}this._banner_place=banner_place;this._init(true);window.addEvent('resize',this.onResize.bind(this));this.attachToObserver(['fatMenuSubMenuFirstOpened','fatMenuLeave'])},onFatMenuSubMenuFirstOpened:function(){this._allow_animation=false},onFatMenuLeave:function(){this._allow_animation=this._allowAnimation()},_init:function(is_first_init){var prev_index=this._getRealIndex(this._index-1),next_index=this._getRealIndex(this._index+1),fx={active:this._elements[this._index],prev:this._elements[prev_index],next:this._elements[next_index]};this._setCssClasses(prev_index,this._index,next_index);Object.forEach(fx,function(element,key){this._removeStyleAttribute(element);var properties=this._getCssProperties(element);this.options.fx[key]=is_first_init?$extend(properties,this.options.fx[key]):$extend(this.options.fx[key],properties)}.bind(this));this._initLeftStyle();this._allow_animation=this._allowAnimation();if(!this._allow_animation){this._removeAllStyleAttribute()}},_allowAnimation:function(){return(this.options.fx.next.display&&this.options.fx.prev.display)},onResize:function(){if(this._refresh_timeout_point){clearTimeout(this._refresh_timeout_point)}this._refresh_timeout_point=setTimeout(function(){this._init(false);if(this._is_run){this._clearTransform()}}.bind(this),this.options._refresh_timeout_time)},_getCssProperties:function(element){var result={};this.options.css_properties.each(function(css){var value=element.getStyle(css);if(css==this.options._display.property){result[css]=value!=this.options._display.hide}else if(!isNaN(parseFloat(value))){result[css]=parseFloat(value)}else{result[css]=0}}.bind(this));return result},run:function(index){var end_index,direction_up=this._isDirectionUp(index),element_parent,no_effect_duration=this.options.duration/2;this._startEffect();if((index==0&&this._index==this._elements_length-1)||(this._index==0&&index==this._elements_length-1)||Math.abs(this._index-index)==1){this._run(index)}else{end_index=direction_up?Math.max(this._index+1,index):Math.min(this._index-1,index);element_parent=this._elements[0].getParent();new Fx.Style(element_parent,'opacity',{duration:no_effect_duration,onComplete:function(){this._setCssClasses(this._getRealIndex(end_index-1),end_index,this._getRealIndex(end_index+1));this._index=end_index;new Fx.Style(element_parent,'opacity',{duration:no_effect_duration,onComplete:this._endEffect.bind(this)}).start(1)}.bind(this)}).start(0)}},_run:function(index){var fx_styles_options={duration:this.options.duration,wait:false},prev_index=this._getRealIndex(index-1),next_index=this._getRealIndex(index+1),direction_up=this._isDirectionUp(index),trail_index=this._getRealIndex(direction_up?prev_index-1:next_index+1),position,current_fx,prev_fx,next_fx;if(this._allow_animation&&this._elements_length>=this.options.min_elements_count){this._clearTransform();for(position=0;position<this._elements_length;position++){if(position!=index&&position!=prev_index&&position!=next_index){if(position==trail_index){(new Fx.Styles(this._elements[position],fx_styles_options)).start(this.options.fx.other)}else{this._elements[position].setStyles(this.options.fx.other)}}}current_fx=new Fx.Styles(this._elements[index],fx_styles_options);prev_fx=new Fx.Styles(this._elements[prev_index],fx_styles_options);next_fx=new Fx.Styles(this._elements[next_index],fx_styles_options);next_fx.setOptions({onComplete:function(){this._setCssClasses(prev_index,index,next_index);this._index=index;this._endEffect()}.bind(this)});current_fx.start(this.options.fx.active);prev_fx.start(this.options.fx.prev);next_fx.start(this.options.fx.next);this._setZIndex(index,(direction_up?prev_index:next_index))}else{this._setCssClasses(prev_index,index,next_index);this._index=index;this._endEffect()}},_setZIndex:function(active_index,middle_index){for(var position=0;position<this._elements_length;position++){if(position==active_index){this._elements[position].setStyle(this.options._zIndex.property,this.options._zIndex.front)}else if(position==middle_index){this._elements[position].setStyle(this.options._zIndex.property,this.options._zIndex.middle)}else{this._elements[position].setStyle(this.options._zIndex.property,this.options._zIndex.back)}}},_setCssClasses:function(prev,index,next){this._clearCss();this._elements[index].addClass(this.options.css.active);if(prev!=next){this._elements[prev].addClass(this.options.css.prev);this._elements[next].addClass(this.options.css.next)}if(this._banner_place&&this._elements_length<this.options.min_elements_count){this._banner_place.addClass(this.options.css.no_animations_control)}else{this._banner_place.removeClass(this.options.css.no_animations_control)}},_clearCss:function(){this._elements.each(function(element){[this.options.css.active,this.options.css.next,this.options.css.prev].each(function(css_class){element.removeClass(css_class)})}.bind(this))},_removeStyleAttribute:function(element){element.removeAttribute('style');element.setAttribute('style','')},_removeAllStyleAttribute:function(){for(var position=0;position<this._elements_length;position++){this._removeStyleAttribute(this._elements[position])}},_isDirectionUp:function(index){var direction_up=true;if(index==0&&this._index==this._elements_length-1){direction_up=true}else{direction_up=(index>this._index)}return direction_up},_getRealIndex:function(index){var element_index=null;if(index<0){element_index=this._elements_length-1}else if(index>=this._elements_length){element_index=0}else{element_index=index}return element_index},_startEffect:function(){this._is_run=true;this.fireEvent('startEffect')},_endEffect:function(){this._is_run=false;this._removeAllStyleAttribute();this.fireEvent('endEffect')},_clearTransform:function(){var prev_index=this._getRealIndex(this._index-1),next_index=this._getRealIndex(this._index+1),transform='translate(0%, 0%)',styles={'-ms-transform':transform,'-webkit-transform':transform,'-o-transform':transform,'-moz-transform':transform,'transform':transform};this._initLeftStyle();this._elements.forEach(function(element,index){if(prev_index==index){this._elements[index].setStyles($extend(styles,{left:this.options.fx.prev.left}))}else if(next_index==index){this._elements[index].setStyles($extend(styles,{left:this.options.fx.next.left}))}else{this._elements[index].setStyles($extend(styles,{left:this.options.fx.active.left}))}}.bind(this))},_initLeftStyle:function(){var next=this._elements[this._getRealIndex(this._index+1)],active=this._elements[this._index];this.options.fx.prev.left=0;if(active.offsetLeft>active.offsetWidth/2){this.options.fx.other.left=this.options.fx.active.left=active.offsetLeft-active.offsetWidth/2}if(next.offsetLeft>next.offsetWidth){this.options.fx.next.left=next.offsetLeft-next.offsetWidth}}});BigPromoEffect_class.implement(new Events(),new Options());var Swipe_class=new Class({Class:'Swipe_class',options:{_event_start:'touchstart',_event_end:'touchend',tolerant_step:10,ie_touch_class:'ms-touch-action-none'},_startMove:false,_startX:null,_startY:null,_element:null,initialize:function(element,swipe_callback,options){this.setOptions(options);this._element=$(element);if(window.navigator.pointerEnabled){this.options._event_start='pointerdown';this.options._event_end='pointerup';this._element.addClass(this.options.ie_touch_class)}else if(window.navigator.msPointerEnabled){this.options._event_start='mspointerdown';this.options._event_end='mspointerup';this._element.addClass(this.options.ie_touch_class)}this._element.addEvent(this.options._event_start,this._onTouchStart.bind(this));this._element.addEvent(this.options._event_end,this._onTouchEnd.bind(this));this.addEvent('swipe',swipe_callback)},_onTouchStart:function(event){if(!this._startMove&&this._isTouch(event)){var point=this._getEventPoint(event);this._startX=point.x;this._startY=point.y;this._startMove=true}},_onTouchEnd:function(event){if(this._startMove){var point=this._getEventPoint(event),x=point.x,y=point.y,horizontal=(x>this._startX)?"right":"left",vertical=(y>this._startY)?"down":"up";if(Math.abs(x-this._startX)>this.options.tolerant_step||Math.abs(y-this._startY)>this.options.tolerant_step){this.fireEvent('swipe',{horizontal:horizontal,vertical:vertical})}this._startMove=false}},_getEventPoint:function(event){var touch=this._isIE()?event:event.changedTouches[0];return{x:touch.pageX,y:touch.pageY}},_isTouch:function(event){return(this._isIE()&&event.pointerType=="touch")||(event.touches&&event.touches.length==1)},_isIE:function(){return window.navigator.pointerEnabled||window.navigator.msPointerEnabled}});Swipe_class.implement(new Options(),new Events());var BigPromo_class=new Class({Class:'BigPromo_class',banner:{},banner_place:{},active_page_key:0,TimerChangePage:null,TimerStartSlideShow:null,passive_page_ids:null,_controls:[],options:{selectors:{pages:'ul[name=pages] li',images:'ul[name=images] li',controls:'[name=controls]'},classes:{active:'active',invisible:'invisible'},properties:{controls:'data-direction'},periodSlideShow:5000,delayAfterClick:120000,tpl:'{var count=0} <ul class=\"clearfix big-promo-l\" name=\"images\"> {for page in pages} {if !count} <li class=\"big-promo-i active\"> <a href=\"${page.url}\" class=\"big-promo-link responsive-img\"> <img src=\"${page.src}\" width=\"${page.width}\" height=\"${page.height}\" alt=\"${page.alt}\" class=\"big-promo-icon\" \/> <\/a> <\/li> {else} <li class=\"big-promo-i\"> <a href=\"${page.url}\" class=\"big-promo-link responsive-img\"> <img src=\"${page.src}\" width=\"${page.width}\" height=\"${page.height}\" alt=\"${page.alt}\" class=\"big-promo-icon\" \/> <\/a> <\/li> {\/if} {var count=count+1} {\/for} <\/ul> <a href=\"#\" name=\"controls\" class=\"sprite-side big-promo-arrows-left\" data-direction=\"left\">&lt;<\/a> <a href=\"#\" name=\"controls\" class=\"sprite-side big-promo-arrows-right\" data-direction=\"right\">&gt;<\/a> {var count_pages=1} <nav class=\"pos-fix\" role=\"navigation\"> <div class=\"big-promo-paginator\"> <ul class=\"big-promo-paginator-l\" name=\"pages\"> {if count > 1} {for page in pages} {if count_pages == 1} <li class=\"big-promo-paginator-l-i active\"> <a href=\"#\" class=\"big-promo-paginator-l-i-link\"> <img src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" width=\"16\" height=\"14\" alt=\"&#9679;\" \/> <\/a> <\/li> {else} <li class=\"big-promo-paginator-l-i\"> <a href=\"#\" class=\"big-promo-paginator-l-i-link\"> <img src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" width=\"16\" height=\"14\" alt=\"&#9679;\" \/> <\/a> <\/li> {\/if} {var count_pages = count_pages + 1} {\/for} {\/if} <\/ul> <\/div> <\/nav>',effect:null,is_controls_disabled:false,allow_swipe:false,effect_options:{}},effect:null,_swiped:[],initialize:function(id_banner_place,banner,place,options){this.setOptions(options);this.banner_place=$(id_banner_place);this.banner=banner;this.place=place;this.passive_page_ids=[];if(this.banner){this.banner_place.setHTML(App.getHTML(this.options.tpl,this.banner));if(this.banner.pages){this._initGTMInitialEvents(this.banner.pages)}}this.images=this.banner_place.getElements(this.options.selectors.images);this.pages=this.banner_place.getElements(this.options.selectors.pages);this.activePaginator();this._initControls();this.startSlideShow();this.addEventOnImagesClick();if(this.options.allow_swipe&&App.isTouchDevice()){this.addEventOnImagesSwipe()}this.attachToObserver(['fatMenuSubMenuFirstOpened','fatMenuLeave']);if(this.options.effect!=null){this.effect=new(App.getConstructorByClassName(this.options.effect))(this.images,this.active_page_key,this.banner_place,this.options.effect_options);this.effect.addEvent('startEffect',function(){this.is_controls_disabled=true}.bind(this));this.effect.addEvent('endEffect',function(){this.is_controls_disabled=false}.bind(this))}},_initGTMInitialEvents:function(banners){if(banners.length){for(var i=0;i<banners.length;i++){GTMData_Banners.setEventDataImpression(banners[i].alt,'big_promo',this.banner_place,'Promo',i+1)}}},_initControls:function(){this._controls=this.banner_place.getElements(this.options.selectors.controls);this._controls.each(function(control){if(this.pages.length>1){control.addEvent('click',this._clickControl.bind(this))}else{control.hide()}}.bind(this))},_clickControl:function(event){new Event(event).stop();if(!this.is_controls_disabled){this.changePageByDirection(event.target.getProperty(this.options.properties.controls))}},changePageByDirection:function(direction){if(direction=='left'){if(this.active_page_key>0){this.setActivePage(this.active_page_key-1)}else{this.setActivePage(this.pages.length-1)}this._trackEvent('switch')}else{this.changePage('switch')}this.startSlideShow()},onFatMenuSubMenuFirstOpened:function(){if(this.effect){this.stopSlideShow()}else{this.banner_place.addClass(this.options.classes.invisible)}},onFatMenuLeave:function(){this.banner_place.removeClass(this.options.classes.invisible);if(this.effect){this.startSlideShow()}},startSlideShow:function(){if(this.TimerChangePage){$clear(this.TimerChangePage)}this.TimerChangePage=this.changePage.periodical(this.options.periodSlideShow,this);this._trackEvent('passive-switch')},stopSlideShow:function(){$clear(this.TimerChangePage)},activePaginator:function(){this.pages.each(function(item,key){item.addEvent('click',function(e){this.onClickToPage(e,key)}.bind(this))}.bind(this))},onClickToPage:function(e,key){var event=new Event(e).stop();if(!this.is_controls_disabled){if(this.TimerStartSlideShow){$clear(this.TimerStartSlideShow)}this.stopSlideShow();this.setActivePage(key);this.TimerStartSlideShow=this.startSlideShow.delay(this.options.delayAfterClick,this);this._trackEvent('switch')}},changePage:function(action){if(this.pages.length>this.active_page_key+1){this.setActivePage(this.active_page_key+1)}else{this.setActivePage(0)}this._trackEvent(action||'passive-switch')},setActivePage:function(key){var active=this.options.classes.active;if(this.active_page_key!=key){if(this.effect){this.effect.run(key)}else{this.images.removeClass(active);this.images[key].addClass(active)}this.pages.removeClass(active);this.pages[key].addClass(active);this.active_page_key=key}},_trackEvent:function(action){var location=(this.options['events']&&this.options.events['location'])?this.options.events.location:null;if(this.images.length){var content=null,el=this.images[this.active_page_key],img=el.getElement('img'),data_img=el.getElement('[class$="promo-icon"]');if(img){content=img.getAttribute('alt')}else if(data_img&&data_img.hasAttribute('data-alt')){content=data_img.getAttribute('data-alt')}switch(action){case'passive-switch':if(!this.passive_page_ids.contains(this.active_page_key)&&window.getSize().scroll.y<this.banner_place.getPosition().y){this.fireEvent('switchBigPromo',[content,this.active_page_key+1,null,location]);this.passive_page_ids.push(this.active_page_key)}break;default:this.fireEvent('switchBigPromo',[content,this.active_page_key+1,action,location]);break}}},addEventOnImagesClick:function(){this.images.each(function(item){item.getElement('a').addEvent('click',function(item){this._trackEvent('click')}.bind(this))}.bind(this))},addEventOnImagesSwipe:function(){this._swiped=[];this.images.each(function(item){this._swiped.push(new Swipe_class(item.getElement('img'),this._onSwipe.bind(this)))}.bind(this))},_onSwipe:function(direction){this.changePageByDirection(direction.horizontal=="left"?"right":"left")},getParamFromUrl:function(url){var param=url.match(/utm_campaign=([^&]*)/i);return(param&&param[1])?param[1]:url}});BigPromo_class.implement(new Events(),new Options());var RozetkaMainBlock_class=new Class({options:{count_element_in_block:6,template:'<h3 class=\"popular-categories-title\">{if title}${title}{else}\u041f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438{\/if}<\/h3> {var start=0} {var step=5} {var index=0} {var lines=sections.slice(0, Math.ceil(sections.length\/step))} <div class=\"popular-categories-items\" name=\"main_page_menu_categories\"> {for line in lines} <div class=\"popular-categories-items-tr\"> {for section in sections} {if index >= start && index < (step + start) && sections[index]} {if sections[index].title_is_href == 1} <a href=\"${sections[index].href}\" data-title=\"${sections[index].title}\" class=\"popular-categories-i\" onclick=\"document.fireEvent(\u0027menu_categories_click\u0027)\"> <span class=\"popular-categories-i-img\"> ${sections[index].image} <\/span> <span class=\"popular-categories-i-title\">${sections[index].title}<\/span> <\/a> {else} <span class=\"novisited popular-categories-i\"> <span class=\"popular-categories-i-img\"> ${sections[index].image} <\/span> <span class=\"popular-categories-i-title\">${sections[index].title}<\/span> <\/span> {\/if} {eval}index++{\/eval} {\/if} {\/for} {eval}start=index{\/eval} <\/div> {\/for} <\/div> ',classes:{invisible:'invisible'}},data:null,elem:null,is_random:false,initialize:function(selector,data,is_random){this.elem=$(selector);this._setData(data);if(is_random){this.is_random=is_random}if(this.elem&&this.elem.getProperty('hide_on_fatmenu')){this.attachToObserver(['fatMenuSubMenuFirstOpened','fatMenuLeave','fatMenuHalfVisibility'])}},onFatMenuSubMenuFirstOpened:function(){this.elem&&this.elem.addClass(this.options.classes.invisible)},onFatMenuLeave:function(){this.elem&&this.elem.removeClass(this.options.classes.invisible)},onFatMenuHalfVisibility:function(){this.elem&&this.elem.removeClass(this.options.classes.invisible)},init:function(){if(this.elem){this.elem.setHTML(App.getHTML(this.options.template,this._getData()));this.firePluginEvent('loadContentComplete')}},_setData:function(data){this.data=data},_getData:function(){return this._prepareData(this.data)},_prepareData:function(data){var random_sections;if(data.sections){if(this.is_random){random_sections=this.data.sections.getRandomFrom(this.options.count_element_in_block);random_sections.sort(this._sort.bind(this));data.sections=random_sections}else{data.sections=data.sections.slice(0,this.options.count_element_in_block)}}return data},_sort:function(a,b){if(a.order>b.order)return 1;if(a.order<b.order)return-1}});RozetkaMainBlock_class.implement(new Options(),new Events(),new PluginEvents_class());var RozetkaPopularGoodsBlock=RozetkaMainBlock_class.extend({options:{template:'{var count=0} <h2 class=\"popular-g-title\">{if title}${title}{else}\u041f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0435 \u0442\u043e\u0432\u0430\u0440\u044b{\/if}<\/h2> <div class=\"g-i-table\"> <div class=\"g-i-tr g-i-tr-fourth\"> {for record in data} {var offer = record.offers[0]} ${rozetkaEvents.setGoodsData(offer)} ${GTMEventsData.setGoodsData(offer.id, offer)} {var count=count+1} <div class=\"g-i-td\" id=\"catalog_item${offer.id}\" data-location=\"${service_title}\" data-context=\"${offer.users_rating.count_comments}\"> <div class=\"g-i-tile\"> <div class=\"popular-cat-title\"> <a href=\"${record.href}\" onclick=\"document.fireEvent(\u0027menu_categories_click\u0027)\" class=\"arrow-link popular-cat-title-link\"> <span class=\"arrow-link-inner\">${record.title}<\/span>&nbsp;&rarr; <\/a> <\/div> <figure class=\"g-img\"> <div class=\"g-img-inner g-img-inner-250\"> <a href=\"${offer.href}\" class=\"g-i-img-link pos-fix responsive-img\" onclick=\"document.fireEvent(\u0027goodsImageClick\u0027,{extend_event:[{name:\u0027goods_id\u0027,value:${offer.id}},{name:\u0027eventLocation\u0027,value:\u0027${service_title}\u0027}]});\"> <img src=\"${offer.image_src}\" class=\"centering-img\"\/> <\/a> <div class=\"g-id\" style=\"display: none;\">${offer.id}<\/div> <\/div> <\/figure> <div class=\"g-title g-title-elipsis\"> <a href=\"${offer.href}\" class=\"g-title-link popular-g-i-title-link\" onclick=\"document.fireEvent(\u0027goodsTitleClick\u0027,{extend_event:[{name:\u0027goods_id\u0027,value:${offer.id}},{name:\u0027eventLocation\u0027,value:\u0027${service_title}\u0027}]});\">${offer.title}<\/a> <\/div> <div class=\"clearfix\"> <div class=\"g-price float-lt popular-g-price\"> <div class=\"g-price-uah\"> ${offer.price.primary.decimals}<span class=\"g-price-uah-sign\">&thinsp;${offer.price.primary.unit}<\/span> <\/div> <\/div> <div class=\"inline\"> <div class=\"g-buy\" name=\"buy_details_recent_goods\" goods_id=\"${offer.id}\"><\/div> <ul class=\"inline g-tools g-tools-delimiter\"> <li class=\"g-tools-i\" id=\"main-wishlist-popup-${offer.id}\"><\/li> <\/ul> <\/div> <\/div> <div class=\"g-rating\"> {if offer.users_rating.count_comments && (offer.users_rating.count_comments > 0)} {var comment_morph = [\u0027\u043e\u0442\u0437\u044b\u0432\u0027, \u0027\u043e\u0442\u0437\u044b\u0432\u0430\u0027, \u0027\u043e\u0442\u0437\u044b\u0432\u043e\u0432\u0027]} {var plural_form = plural(offer.users_rating.count_comments)} <a class=\"novisited g-rating-reviews-link\" href=\"${offer.users_rating.comments_href}\"> {if offer.users_rating.value} <span class=\"sprite g-rating-stars\"> <span class=\"sprite g-rating-stars-i\" style=\"width:${offer.users_rating.value*20}%\"><\/span> <\/span> <span class=\"g-rating-reviews\"> ${offer.users_rating.count_comments} ${comment_morph[plural_form]} <\/span> {else} <span class=\"g-rating-reviews\"> <span class=\"g-rating-none sprite-side\">${offer.users_rating.count_comments} ${comment_morph[plural_form]}<\/span> <\/span> {\/if} <\/a> {\/if} <\/span> <\/div> <\/div> <\/div> {if count % 4 == 0 }<\/div><div class=\"g-i-tr g-i-tr-fourth\">{\/if} {\/for} <\/div> <div class=\"g-i-tr g-i-tr-psevdo g-i-tr-fourth\"> <div class=\"g-i-td\">&nbsp;<\/div> <div class=\"g-i-td\">&nbsp;<\/div> <div class=\"g-i-td\">&nbsp;<\/div> <div class=\"g-i-td\">&nbsp;<\/div> <\/div> <\/div>',block_ajax_action:null,ajax_action:null,block_type:'default'},blocks:{},unit_id:'',is_data_loaded:false,initialize:function(selector,unit_id,is_random){this.elem=$(selector);this.unit_id=unit_id;if(is_random){this.is_random=is_random}},init:function(){try{if(this.elem){NewRecentGoods.addEvent('recentGoodsShowed',function(){this.is_data_loaded=false;this._getData()}.bind(this))}}catch(e){App.err(e);this.options.block_type='default';this._getData()}},_getBlockElementData:function(url){return new Promise(function(resolve,reject){var action=url;var ajax=new Ajax(action,{method:'get',use_language:true});ajax.addEvent('onComplete',this._onCompleteBlockElementLoad.bind(this,[resolve,reject]));ajax.request()}.bind(this))},_onCompleteBlockElementLoad:function(params,e){var response=new Response_class(e);if(response.isDone()){params[0](response.content)}else{params[1](response.code)}},_getDataDefault:function(){var action=this.options.ajax_action+';unit_id='+this.unit_id+'/';var ajax=new Ajax(action,{method:'get',use_language:true}).request();ajax.addEvent('onComplete',function(e){this._onCompleteDefault(e)}.bind(this))},_getDataForSpecificBlock:function(){var recent_goods=NewRecentGoods.getSortedGoods();if(recent_goods){var urls=[];for(var i=0;i<recent_goods.length&&urls.length<this.options.count_element_in_block;i++){urls.include(this.options.block_ajax_action+';parent_id='+recent_goods[i].parent_id+';type='+this.options.block_type+'/')}urls.include(this.options.ajax_action+';unit_id='+this.unit_id+'/')}Promise.all(urls.map(this._getBlockElementData.bind(this))).then(function(responses){var data=this._prepareAdditionalData(responses);this._render(data,this.options.title,this.options.service_title);this.sendGoodsToAnalytics(data)}.bind(this),function(response_code){App.err(response_code)})},sendGoodsToAnalytics:function(data){if(!this._analytic_send){document.fireEvent('goodsBlockViewed',{extend_event:[{name:'products',value:this._mapGoodsData(data)}]});this._analytic_send=true}},_getData:function(){var type_handlers={'':this._getDataDefault.bind(this),'default':this._getDataDefault.bind(this),popularity:this._getDataForSpecificBlock.bind(this),novelty:this._getDataForSpecificBlock.bind(this)};if(!this.is_data_loaded){type_handlers[this.options.block_type]();this.is_data_loaded=true}},_render:function(data,title,service_title){if(data.length>=this.options.count_element_in_block){this.elem.setHTML(App.getHTML(this.options.template,{data:data,title:title,service_title:service_title}))}this.firePluginEvent('loadContentComplete');this._setActiveElements()},_onCompleteDefault:function(e){var response=new Response_class(e);if(response.isDone()){var data=this._prepareData(response.content);this._render(data,response.content.unit.title,response.content.unit.service_title)}},_setActiveElements:function(){Wishlists.setOptions({tpl_catalog_tile_init:'<span name=\"wishlists_main\"><\/span>'});this.elem.getElements('[name=buy_details_recent_goods]').each(function(el){if(el.getProperty('goods_id')){Wishlists.setCatalogTilePopupParent('main-wishlist-popup-'+el.getProperty('goods_id'));GoodsCatalog.add(el.getProperty('goods_id'),'main')}})},_prepareData:function(data){var records;if(this.is_random){var random_records=data.records.getRandomFrom(data.unit.count_element);records=random_records.sort(this._sort.bind(this))}else{records=data.records.slice(0,data.unit.count_element)}records.each(function(elem){if(elem.offers.length){var offer=elem.offers.getRandom();elem.offer=offer}});return records},_prepareAdditionalData:function(data){var additional_data=[];data=data.filter(function(item,index){return $defined(item.main)||$defined(item.records)});for(var i=0;i<data.length;i++){if(data[i].main){additional_data.merge([data[i].main]);if(data[i].accessory){additional_data.merge([data[i].accessory])}}if(data[i].records){additional_data.merge(this._prepareData(data[i]))}}data=this._filterNonUniqueGoods(additional_data);data=data.slice(0,this.options.count_element_in_block);return data},_filterNonUniqueGoods:function(blocks){var index=[],unique_blocks=[];for(var i=0;i<blocks.length;i++){if(!index.contains(blocks[i].offers[0].parent_id)){index.include(blocks[i].offers[0].parent_id);unique_blocks.include(blocks[i])}}return unique_blocks},_mapGoodsData:function(data){var location_by_block={default:'',popularity:'popular',novelty:'novelty'};var goods_data=[],counter=0;Object.each(data,function(item){goods_data.push({productName:item.offers[0].title,productID:item.offers[0].id,productCategoryID:item.offers[0].parent_id,productVendorID:item.offers[0].producer_id,productPrice:item.offers[0].price_usd,productPosition:++counter,productLocation:location_by_block[this.options.block_type],productSellerID:item.offers[0].seller_id,productMerchantID:item.offers[0].merchant_id})}.bind(this));return goods_data}});var RozetkaRecommendRecentGoodsBlock=RozetkaNewRecentGoods_class.extend({options:{selectors:{scroller:'[name=recommend_goods_scroller]',blocks:'[name=block_recommend_goods]'},template:'<div class=\"viewed\" id=\"recommend_goods_scroller\" name=\"recommend_goods_scroller\" _action=\"${scroller_action}\"> <header class=\"viewed-heading\"> <h2>${title}<\/h2> <\/header> <div class=\"clearfix slider\" name=\"recommend_goods_screen\"> <a href=\"#\" class=\"sprite-side slider-al hidden{if location == \u0027cart\u0027} cart-viewed-al{\/if}\" name=\"recommend_goods_control\" _action=\"left\" data-direction=\"left\">&lt;<\/a> <a href=\"#\" class=\"sprite-side slider-ar hidden{if location == \u0027cart\u0027} cart-viewed-ar{\/if}\" name=\"recommend_goods_control\" _action=\"right\" data-direction=\"right\">&gt;<\/a> <div class=\"slider-inner\"> <div class=\"g-i-tr-block\" name=\"recommend_goods_container\"> {if data} {var i=1} {for item in data} ${rozetkaEvents.setGoodsData(item)} ${GTMEventsData.setGoodsData(item.id, item)} {if !lang_suffix}{var lang_suffix = \u0027\u0027}{\/if} {if item[\u0027title\u0027 + lang_suffix]} {var item_title = item[\u0027title\u0027 + lang_suffix]} {else} {var item_title = item.title} {\/if} {if item[\u0027href\u0027 + lang_suffix]} {var item_href = item[\u0027href\u0027 + lang_suffix]} {else} {var item_href = item.href} {\/if} <div class=\"slider-i-td ${item.sell_status} {if data.length == 1}single{\/if}{if data.length == 2}twice{\/if}{if data.length == 3}third{\/if}{if data.length == 4}fourth{\/if}\" name=\"recommend_goods_item\"> <div id=\"catalog_item${item.id}\" tool_tip=\"1\" class=\"slider-i viewed-i\" data-location=\"${block_name}\" data-position=\"${i++}\" data-context=\"${item.count_comments}\"> <input type=\"hidden\" name=\"slider_pos_number${item.id}\" value=\"${parseInt(item_index)+1}\" \/> <input type=\"hidden\" name=\"content_gtm${item.id}\" value=\"${item.source}\" \/> <input type=\"hidden\" name=\"num_block${item.id}\" value=\"${num_block}\" \/> <div class=\"viewed-i-col-left\"> <figure class=\"g-img{if data.length == 1} float-lt{\/if}\"> <div class=\"g-img-inner g-img-inner-150 pos-fix\"> <a href=\"${item_href}\" class=\"g-i-img-link\" onclick=\"document.fireEvent(\u0027goodsImageClick\u0027,{extend_event:[{name:\u0027goods_id\u0027,value:${item.id}},{name:\u0027eventLocation\u0027,value:\u0027${block_name}\u0027}, {name:\u0027eventField\u0027,value:\u0027${num_block} block\u0027}]});\"> {if item.special_prices} {for special_price in item.special_prices} <span class=\"g-tag hidden\" name=\"icon_prices|${special_price.promotion.special_price}\"> ${special_price.promotion.image_tag} <\/span> {\/for} {\/if} <span class=\"g-tag g-tag-viewed\"> {if item.tag==\"popularity\"} <img alt=\"\u0422\u043e\u043f \u043f\u0440\u043e\u0434\u0430\u0436\" class=\"sprite g-tag-icon-small-popularity\" src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" \/> {elseif item.tag==\"superprice\"} <img alt=\"\u0421\u0443\u043f\u0435\u0440\u0446\u0435\u043d\u0430\" class=\"sprite g-tag-icon-small-superprice\" src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" \/> {elseif item.tag==\"novelty\"} <img alt=\"\u041d\u043e\u0432\u0438\u043d\u043a\u0430\" class=\"sprite g-tag-icon-small-novelty\" src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" \/> {elseif item.tag==\"action\"} <img alt=\"\u0410\u043a\u0446\u0438\u044f\" class=\"sprite g-tag-icon-small-action\" src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" \/> {elseif item.tag==\"exclusive\"} <img alt=\"\u042d\u043a\u0441\u043a\u043b\u044e\u0437\u0438\u0432\u043d\u043e\" class=\"sprite g-tag-icon-small-exclusive\" src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" \/> {\/if} <\/span> {if item.large_image} <img class=\"g-img-icon centering-img\" src=\"\" data_src=\"${item.large_image.url}\" width=\"${item.large_image.width}\" height=\"${item.large_image.height}\" alt=\"${item_title|escape}\" title=\"${item_title|escape}\" \/> {else} <img class=\"g-img-icon centering-img\" src=\"\" data_src=\"${item.image.url}\" width=\"${item.image.width}\" height=\"${item.image.height}\" alt=\"${item_title|escape}\" title=\"${item_title|escape}\" \/> {\/if} <\/a> <\/div> <\/figure> <\/div> <div class=\"viewed-i-col-right\"> <div class=\"g-title\"> <a href=\"${item_href}\" class=\"g-title-link viewed-i-title-link novisited\" onclick=\"document.fireEvent(\u0027goodsTitleClick\u0027,{extend_event:[{name:\u0027goods_id\u0027,value:${item.id}},{name:\u0027eventLocation\u0027,value:\u0027${block_name}\u0027}, {name:\u0027eventField\u0027,value:\u0027${num_block} block\u0027}]});\"> ${item_title|escape} <\/a> <\/div> {if item.sell_status != \u0027available\u0027} <div class=\"g-i-status-wrap\"> <div class=\"g-i-status ${item.sell_status}\"> {if item.sell_status == \u0027limited\u0027} \u0417\u0430\u043a\u0430\u043d\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f {elseif item.sell_status == \u0027unavailable\u0027} \u041d\u0435\u0442 \u0432 \u043d\u0430\u043b\u0438\u0447\u0438\u0438 {elseif item.sell_status == \u0027out_of_stock\u0027} \u0417\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u0441\u044f {elseif item.sell_status == \u0027waiting_for_supply\u0027} \u041e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u0442\u0430\u0432\u043a\u0430 {elseif item.sell_status == \u0027archive\u0027} \u0421\u043d\u044f\u0442 \u0441 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0441\u0442\u0432\u0430 {\/if} <\/div> {if item.sell_status == \u0027out_of_stock\u0027} <div class=\"viewed-lable-out_of_stock\"> <img src=\"http:\/\/i.rozetka.ua\/design\/sprite\/sales-small.png\" alt=\"\u041f\u0440\u043e\u0434\u0430\u043d\u043e\"\/> <\/div> {\/if} <\/div> {\/if} {if item.price > 0 && item.sell_status != \u0027archive\u0027} {if item.old_price && item.old_price > item.price} <div class=\"g-price-old\"> <div class=\"g-price-old-inner\"> <div class=\"g-price-old-uah\"> ${item.old_price.toString().toPriceFormat()}<span class=\"g-price-old-uah-sign\">&thinsp;\u0433\u0440\u043d<\/span> <\/div> <\/div> <\/div> {\/if} <div class=\"g-price{if item.old_price && item.old_price > item.price} g-price-cheaper{\/if}\" name=\"prices_active_element_original\"> <div class=\"g-price-uah\"> ${item.price.toString().toPriceFormat()}&nbsp;<span class=\"g-price-uah-sign\">\u0433\u0440\u043d<\/span> <\/div> <\/div> {\/if} {if item.sell_status == \u0027available\u0027 || item.sell_status == \u0027limited\u0027 || item.sell_status == \u0027call\u0027} <div class=\"clearfix\"> <div class=\"g-buy\" name=\"buy_details_recomm_goods\" goods_id=\"${item.id}\"><\/div> <ul class=\"inline g-tools\"> <li class=\"g-tools-i\" name=\"wishlists_recomm_goods\"><\/li> <li class=\"g-tools-i g-tools-delimiter\" name=\"recomm_goods_comparison_details\"><\/li> <\/ul> <\/div> <div class=\"g-rating\"> {if item.count_comments > 0} {var comment_morph = [\u0027\u043e\u0442\u0437\u044b\u0432\u0027, \u0027\u043e\u0442\u0437\u044b\u0432\u0430\u0027, \u0027\u043e\u0442\u0437\u044b\u0432\u043e\u0432\u0027]} {var plural_form = plural(item.count_comments)} <a class=\"novisited g-rating-reviews-link\" href=\"${item.comments_href}\"> {if item.users_rating > 0} <span class=\"sprite g-rating-stars\"> <span class=\"sprite g-rating-stars-i\" style=\"width:${item.users_rating*20}%\"><\/span> <\/span> <span class=\"g-rating-reviews\"> ${item.count_comments} ${comment_morph[plural_form]} <\/span> {else} <span class=\"g-rating-reviews\"> <span class=\"g-rating-none sprite-side\">${item.count_comments} ${comment_morph[plural_form]}<\/span> <\/span> {\/if} <\/a> {\/if} <\/div> {elseif item.sell_status != \u0027archive\u0027} <div class=\"main-personal-to-waitlist\" name=\"waitlist\" goods_id=\"${item.id}\"> <span name=\"waitlist_recommend_goods\"><\/span> <\/div> {else} <div class=\"g-i-new-models-link\"> <a href=\"${item.section_href}producer=${item.producer};sort=novelty\/\" class=\"novisited arrow-link\">\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c \u043d\u043e\u0432\u044b\u0435&nbsp;&rarr;<\/a> <\/div> {\/if} <\/div> <\/div> <\/div> {\/for} {\/if} <\/div> <\/div> <\/div> <\/div>',scroller_options:{elemsContainer:'[name=recommend_goods_container]',elems:'[name=recommend_goods_item]',controls:'[name=recommend_goods_control]',screen:'[name=recommend_goods_screen]',gtm_location:'recommendedRecent'},title_block:null,block_name:'recommendedRecent',scroller_action:'recommend_goods_sroller',filter_block:null},initialize:function(options){this.parent(options);NewRecentGoods.addEvent('recentGoodsShowed',function(){this.showRecentGoods()}.bind(this))},showRecentGoods:function(){$$(this.options.selectors.blocks).each(function(block){this.visualiseRecentGoods(block)}.bind(this));App.fireEvent('renewImages')},getSortedGoods:function(){var parent_goods_data=this.parent(),goods_data=parent_goods_data.length?parent_goods_data[this.options.num_block-1]:null,result=[];if(goods_data){var rec=this.loadRecommendGoods(goods_data.id,false);if(rec){result=rec[this.options.content_div_id];if($defined(this.options.filter_block)){var filter_goods=this.options.filter_block.getSortedGoods();result=this._filterGoods(result,filter_goods)}this.addGTMProducts(result)}else{document.addEvent('loadRecommend',function(goods_id,goods_id_for_check){if(goods_id===goods_id_for_check){this.showRecentGoods()}}.bind(this,goods_data.id))}}else{document.fireEvent('loadBlocksForGTM',{products:[]})}return result},visualiseRecentGoods:function(block){if(block!=null){if(this._getStorageService()===null){}else{var local_storage_goods=this.getSortedGoods();if(this.options.load_details_by_ajax){this.getSortedGoodsAjax(local_storage_goods,this._visualiseRecentGoods.bind(this,block))}else{this._visualiseRecentGoods(block,local_storage_goods)}}}},_filterGoods:function(source_goods,filter_goods){var filtered_goods=[];source_goods.each(function(source){var is_exist=false;filter_goods.each(function(filter){if(!is_exist&&source.id==filter.id){is_exist=true}});if(!is_exist){filtered_goods.push(source)}});return filtered_goods},addGTMProducts:function(goods){var products=[];goods.each(function(item,position){var object={productID:item.id,productName:item.title,eventProductCategoryId:item.parent_id,productVendorID:item.producer_id,productPrice:item.price,productPosition:++position,productSource:item.source,productMerchantID:item.merchant_id,productSellerID:item.seller_id,productField:this.options.num_block+' block',productLocation:'recommendedRecent'};products.push(object)}.bind(this));document.fireEvent('loadBlocksForGTM',{products:products})},_setActionForBuyButton:function(block){GoodsCatalog.findAndAddCatalogItems(block,'main');$(document).fireEvent('loadContentComplete')},onLoadS:function(){this.showRecentGoods();document.addEvent('signIn',this.onSignIn.bind(this));User.addEvent('signOut',this.onSignOut.bind(this))},onSignIn:function(){this.parent()},onSignOut:function(){this.parent()},showRecentGoods:function(){$$(this.options.selectors.blocks).each(function(block){this.visualiseRecentGoods(block)}.bind(this));App.fireEvent('renewImages')},getFromRedis:function(){},sendGoodsToAnalytics:function(goods){}});var RozetkaMiniBlock_class=RozetkaMainBlock_class.extend({options:{template:'',save_state:{storage_class_name:'CookieStorage_class',key_name:'mini_block_state',storage_options:{duration:'7'}},selectors:{mini_block:'#mini-block',open_element:'#mini-block-open',content_block:'#content-block',header_block:'#header-block-content',footer_block:'#footer-block-content',rollup_button:'#rollup-content',rolldown_button:'#rolldown-content',minimized:'#minimized-block',maximized:null,slidable_element:'#center-cart-content'},max_window_width:null,min_window_width:null,hide_before_minimize:false},elem:null,elems:null,_slider:null,_is_resizing:false,initialize:function(block_elem,data,options){this.setOptions(options);this.parent(block_elem,data);this.elem=$(block_elem)},init:function(){this.parent();this._initDynamicElements();this._setSlider();this._updateVisibleState();this.onWindowResize();this.fireEvent('miniBlockInit');$(window).addEvent('resize',this.onWindowResize.bind(this))},_updateVisibleState:function(){if(this.isMinimized()){this._minimize(false);if(this._getSlider()){this._getSlider().hide()}}else{this._maximize(false)}},_initDynamicElements:function(){this.elems=this.initElements(this.options.selectors);if(this.elems.rollup_button){this.elems.rollup_button.addEvent('click',this.onMinimizeClick.bind(this))}if(this.elems.rolldown_button){this.elems.rolldown_button.addEvent('click',this.onMaximizeClick.bind(this))}},onWindowResize:function(){if(!this._is_resizing){this._is_resizing=true;setTimeout(function(){this._is_resizing=false;if((this.options.max_window_width!==null&&this.options.max_window_width>=window.innerWidth)||(this.options.min_window_width!==null&&this.options.min_window_width<=window.innerWidth)){this.show();this._updateVisibleState()}else{this.hide()}}.bind(this),200)}},hide:function(){if(this.elem.isDisplayed()){this.elem.hide()}return this},show:function(){if(!this.elem.isDisplayed()){this.elem.show();this.fireEvent("miniBlockShow")}return this},_setSlider:function(){if(this.elems.slidable_element){this._slider=new Fx.Slide(this.elems.slidable_element,{onComplete:this._onSlideComplete.bind(this)})}},_getSlider:function(){if(!this._slider){this._setSlider()}return this._slider},onMinimizeClick:function(event){new Event(event).stop();if(this.options.hide_before_minimize){this._hideElement('open_element')}this.minimize()},onMaximizeClick:function(event){new Event(event).stop();this.maximize()},_onSlideComplete:function(){if(this.isMinimized()){this.onMinimizeSlideComplete()}},maximize:function(){if(this.isMinimized()){this._maximize();this.fireEvent('miniBlockMaximize');this.fireEvent('toggleMiniBlockState')}},minimize:function(){if(!this.isMinimized()){this._minimize();this.fireEvent('miniBlockMinimize');this.fireEvent('toggleMiniBlockState')}},_minimize:function(with_slide_effect){with_slide_effect=$defined(with_slide_effect)?with_slide_effect:true;this._saveState(true);if(this._getSlider()&&with_slide_effect){this._getSlider().slideOut()}else{if(this._getSlider()){this._getSlider().hide()}this.onMinimizeSlideComplete()}},_maximize:function(with_slide_effect){with_slide_effect=$defined(with_slide_effect)?with_slide_effect:true;this._hideElement('minimized');this._showElement('header_block');this._showElement('content_block');this._showElement('open_element');this._showElement('footer_block');this._showElement('maximized');this._saveState(false);if(this._getSlider()){if(with_slide_effect){this._getSlider().slideIn()}else{this._getSlider().show()}}},onMinimizeSlideComplete:function(){this._hideElement('header_block');this._hideElement('content_block');this._showElement('minimized');this._hideElement('footer_block');this._hideElement('maximized')},_hideElement:function(element_name){if(this.elems[element_name]){this.elems[element_name].hide()}},_showElement:function(element_name){if(this.elems[element_name]){this.elems[element_name].show()}},isMinimized:function(){return this._getStorage().get(this.options.save_state.key_name)==='minimized'},_getStorage:function(){if(this._storage===undefined){this._storage=null;var storage_constructor=App.getConstructorByClassName(this.options.save_state.storage_class_name);if(storage_constructor){this._storage=new storage_constructor(this.options.save_state.storage_options)}}return this._storage},_saveState:function(is_minimized){if(this._getStorage()){var state_value=is_minimized?'minimized':'maximized';this._getStorage().set(this.options.save_state.key_name,state_value)}},_prepareData:function(data){return data}});RozetkaMiniBlock_class.implement(new Options(),new InitElements(),new Events());var RozetkaMiniCartBlock=RozetkaMiniBlock_class.extend({options:{template:' {var count_purchases = getQuantity()} {if count_purchases > 0} {var purchases = getPurchasesGroupedByKit().reverse()} <section class=\"side-cart-wrap\" id=\"mini-cart-block\"> <header id=\u0027rollup-cart-content-purchases\u0027> <div class=\"side-cart-header\" id=\"header-cart-content-purchases\"> {var goods_word = [\u0027\u0442\u043e\u0432\u0430\u0440\u0027, \u0027\u0442\u043e\u0432\u0430\u0440\u0430\u0027, \u0027\u0442\u043e\u0432\u0430\u0440\u043e\u0432\u0027]} {var plural_form = plural(count_purchases)} <h3 class=\"side-cart-header-title\">\u0412&nbsp;\u043a\u043e\u0440\u0437\u0438\u043d\u0435 ${count_purchases} ${goods_word[plural_form]}<\/h3> <div class=\"side-cart-header-amount\">\u043d\u0430 \u0441\u0443\u043c\u043c\u0443 ${S.cost_with_discount.primary.decimals} ${S.cost.primary.unit}<\/div> <span class=\"side-cart-header-toggle-link\"> <img width=\"30\" height=\"31\" src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c\" title=\"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c\" class=\"side-cart-header-toggle-link-img sprite\"> <\/span> <\/div> <\/header> <div class=\"side-cart-main-wrap\" id=\"cart-content-purchases\"> <div class=\"side-cart-main\"> {for purchase in purchases} {var image = purchase.goods.attachments.images[0]} {var variant = image[\u0027medium\u0027] ? \u0027medium\u0027 : \u0027preview\u0027} {var seller = getSellerByPurchaseId(purchase.id)} {var event_position = parseInt(purchase_index) + 1} {if !purchase.kit} <div class=\"side-cart-g-i\"> <a class=\"side-cart-g-i-img responsive-img\" href=\"${purchase.goods.href}\" onclick=\"document.fireEvent(\u0027goodsTitleClick\u0027, {extend_event: [{name: \u0027goods_id\u0027, value: ${purchase.goods.id}}, {name: \u0027eventLocation\u0027, value: \u0027smallCart\u0027}, {name: \u0027eventPosition\u0027, value: \u0027${event_position}\u0027}, {name: \u0027eventContext\u0027, value: \u0027photo\u0027}]})\" > <img src=\"${image[variant].url}\"\/> <\/a> <div class=\"clearfix side-cart-g-i-content\"> <a href=\"${purchase.goods.href}\" class=\"g-title side-cart-g-title novisited\" onclick=\"document.fireEvent(\u0027goodsTitleClick\u0027, {extend_event: [{name: \u0027goods_id\u0027, value: ${purchase.goods.id}}, {name: \u0027eventLocation\u0027, value: \u0027smallCart\u0027}, {name: \u0027eventPosition\u0027, value: \u0027${event_position}\u0027}]})\"> ${purchase.goods.title} <\/a> <div class=\"clearfix side-cart-g-i-price-wrap\"> <div class=\"side-cart-g-i-price\"> <span class=\"side-cart-uah\"> ${purchase.price.primary.string} <\/span> <\/div> <div class=\"side-cart-g-i-inner-wrap\"> <div class=\"side-cart-g-i-amount\">${purchase.quantity} \u0448\u0442.<\/div> <div class=\"side-cart-g-i-sum\"> ${purchase.cost.primary.string} <\/div> <\/div> <\/div> {if seller && seller.seller_id} <div class=\"side-cart-g-i-merchant clearfix\" name=\"seller_block\" seller_id=\"${seller.seller_id}\" popup_layout=\"bottom\"> <span class=\"side-cart-g-i-merchant-text\">\u041f\u0440\u043e\u0434\u0430\u0432\u0435\u0446<\/span> {if seller.href && seller.use_logo_href} <a href=\"${seller.href}\" class=\"side-cart-g-i-merchant-link\" target=\"_blank\"><span class=\"xhr\" >${seller.title}<\/span><\/a> {elseif seller.has_docket && seller.has_docket != 0} <a href=\"#\" class=\"side-cart-g-i-merchant-link\" name=\"show_seller_info\"><span class=\"xhr\" >${seller.title}<\/span><\/a> {else} <span class=\"side-cart-g-i-merchant-link\">${seller.title}<\/span> {\/if} <\/div> {\/if} <\/div> <\/div> {elseif purchase.kit_id && !purchase.parent_id} <div class=\"side-cart-kit-i\"> <h4 class=\"side-cart-kit-i-title\"> \u0410\u043a\u0446\u0438\u043e\u043d\u043d\u043e\u0435 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435 <\/h4> {for kit_purchase in purchase.kit_purchases} {var image = kit_purchase.goods.attachments.images[0]} {var variant = image[\u0027medium\u0027] ? \u0027medium\u0027 : \u0027preview\u0027} {var seller = getSellerByPurchaseId(kit_purchase.id)} {var kit_event_position = parseInt(purchase_index) + parseInt(kit_purchase_index)} <div class=\"side-cart-kit-g-i\"> <a class=\"side-cart-g-i-img responsive-img\" href=\"${kit_purchase.goods.href}\"> <img src=\"${image[variant].url}\" onclick=\"document.fireEvent(\u0027goodsTitleClick\u0027, {extend_event: [{name: \u0027goods_id\u0027, value: ${kit_purchase.goods.id}}, {name: \u0027eventLocation\u0027, value: \u0027smallCart\u0027}, {name: \u0027eventPosition\u0027, value: \u0027${kit_event_position}\u0027}, {name: \u0027eventContext\u0027, value: \u0027photo\u0027}]})\"> {if !purchase.kit.is_show_full_discount && kit_purchase.unit && kit_purchase.unit.percent_discount > 0} <span class=\"side-cart-discount-label\"> &minus;${kit_purchase.unit.percent_discount}% <\/span> {\/if} {if kit_purchase.unit && kit_purchase.unit.quantity > 1} <span class=\"unit-multiplier side-cart-unit-multiplier\">${kit_purchase.unit.quantity}x<\/span> {\/if} <\/a> <div class=\"clearfix side-cart-g-i-content\"> <a href=\"${kit_purchase.goods.href}\" class=\"g-title side-cart-g-title novisited\" onclick=\"document.fireEvent(\u0027goodsTitleClick\u0027, {extend_event: [{name: \u0027goods_id\u0027, value: ${kit_purchase.goods.id}}, {name: \u0027eventLocation\u0027, value: \u0027smallCart\u0027}, {name: \u0027eventPosition\u0027, value: \u0027${kit_event_position}\u0027}]})\"> ${kit_purchase.goods.title} <\/a> <div class=\"clearfix side-cart-g-i-price-wrap\"> {if !purchase.kit.is_show_full_discount && kit_purchase.price_with_discount.primary.raw < kit_purchase.price.primary.raw} <div class=\"side-cart-kit-i-sum\"> ${kit_purchase.price_with_discount.primary.string} <\/div> <div class=\"side-cart-kit-i-sum-without-discount\"> ${kit_purchase.price.primary.string} <\/div> {else} <div class=\"side-cart-kit-i-sum\"> ${kit_purchase.price.primary.string} <\/div> {\/if} <\/div> <\/div> <\/div> {\/for} <div class=\"side-cart-kit-i-merchant-wrap side-cart-g-i-merchant1\" name=\"seller_block\" seller_id=\"${seller.seller_id}\" popup_layout=\"bottom\"> <div class=\"side-cart-kit-i-merchant clearfix\" name=\"seller_block\" seller_id=\"${seller.seller_id}\" popup_layout=\"bottom\"> <span class=\"side-cart-g-i-merchant-text\">\u041f\u0440\u043e\u0434\u0430\u0432\u0435\u0446<\/span> {if seller.href && seller.use_logo_href} <a href=\"${seller.href}\" class=\"side-cart-g-i-merchant-link xhr\" target=\"_blank\">${seller.title}<\/a> {elseif seller.has_docket && seller.has_docket != 0} <a href=\"#\" class=\"side-cart-g-i-merchant-link xhr\" name=\"show_seller_info\">${seller.title}<\/a> {else} <span class=\"side-cart-g-i-merchant-link\">${seller.title}<\/span> {\/if} <\/div> <\/div> <div class=\"side-cart-kit-total {if purchase.kit.is_show_full_discount} side-cart-kit-total-indent {\/if} clearfix\"> <div class=\"side-cart-kit-total-title\">\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u043a\u043e\u043c\u043f\u043b\u0435\u043a\u0442\u0430<\/div> <div class=\"side-cart-kit-amount\">${purchase.quantity} \u0448\u0442.<\/div> {if purchase.kit.is_show_full_discount && (discount = getNotParentDiscounts(purchase.id, \u0027Goods.Kits\u0027).pop())} {var discount_value = purchase.kit.price_without_discount * purchase.quantity - purchase.kit.costKit} {if purchase.kit.percent_discount > 0} <span class=\"side-cart-discount-label side-cart-kit-discount-label\"> &minus;&nbsp;${purchase.kit.percent_discount}% <\/span> {else} {if discount_value > 0} <span class=\"side-cart-discount-label side-cart-kit-discount-label\"> &minus;&nbsp;${discount_value}${purchase.cost.primary.unit} <\/span> {\/if} {\/if} {if purchase.kit.percent_discount > 0 || discount_value > 0} <div class=\"side-cart-kit-uah-old\"> ${(discount.raw_data.cost_without_discount * purchase.quantity).toString().toPriceFormat()}&nbsp;${purchase.cost.primary.unit} <\/div> {\/if} {\/if} <div class=\"side-cart-kit-uah\">${(purchase.kit.costKit).toString().toPriceFormat()}&nbsp;${purchase.cost.primary.unit}<\/div> <\/div> <\/div> {\/if} {\/for} <\/div> <\/div> <footer class=\"side-cart-footer\" id=\"footer-cart-content-purchases\"> <a class=\"side-cart-footer-to-cart novisited\" href=\"https:\/\/my.rozetka.com.ua\/cart\/\" id=\u0027mini-cart-block-open-cart\u0027> <span class=\"side-cart-footer-to-cart-link sprite-side\"> <span class=\"xhr\">\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432&nbsp;\u043a\u043e\u0440\u0437\u0438\u043d\u0443<\/span> <\/span> <\/a> <div class=\"side-cart-footer-to-checkout\"> <span class=\"btn-link btn-link-green\"> <a href=\"https:\/\/my.rozetka.com.ua\/checkout\/\" onclick=\"document.fireEvent(\u0027goToCheckoutFromCart\u0027, {extend_event: [{name:\u0027eventLocation\u0027, value:\u0027smallCart\u0027}]})\" class=\"btn-link-i\" >\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437<\/a> <\/span> <\/div> <\/footer> <div id=\"rolldown-cart-content-purchases\"> <div class=\"side-cart-folded hidden\" id=\"minimized-cart-block\"> {var goods_word = [\u0027\u0442\u043e\u0432\u0430\u0440\u0027, \u0027\u0442\u043e\u0432\u0430\u0440\u0430\u0027, \u0027\u0442\u043e\u0432\u0430\u0440\u043e\u0432\u0027]} {var plural_form = plural(count_purchases)} <h3 class=\"side-cart-header-title folded\">\u0412&nbsp;\u043a\u043e\u0440\u0437\u0438\u043d\u0435 ${count_purchases} ${goods_word[plural_form]}<\/h3> <div class=\"side-cart-header-amount folded\">\u043d\u0430 \u0441\u0443\u043c\u043c\u0443 ${S.cost_with_discount.primary.decimals} ${S.cost.primary.unit}<\/div> <span class=\"side-cart-header-toggle-link\"> <img width=\"30\" height=\"31\" src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c\" title=\"\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c\" class=\"side-cart-header-toggle-link-img folded sprite\"> <\/span> <figure class=\"side-cart-folded-g-img\"> <div class=\"side-cart-folded-g-img-inner clearfix\"> {for purchase in purchases} {if purchase.kit && !purchase.parent_id} {for kit_purchase in purchase.kit_purchases} {var image = kit_purchase.goods.attachments.images[0]} {var variant = image[\u0027small\u0027] ? \u0027small\u0027 : \u0027preview\u0027} <span class=\"responsive-img side-cart-folded-g-img-link\"> <img src=\"${image[variant].url}\" \/> <\/span> {\/for} {elseif !purchase.kit} {var image = purchase.goods.attachments.images[0]} {var variant = image[\u0027small\u0027] ? \u0027small\u0027 : \u0027preview\u0027} <span class=\"responsive-img side-cart-folded-g-img-link\"> <img src=\"${image[variant].url}\" \/> <\/span> {\/if} {\/for} <\/div> <\/figure> <\/div> <\/div> <\/section> {\/if}',save_state:{key_name:'mini_cart_block_state'},selectors:{mini_block:'#mini-cart-block',open_element:'#mini-cart-block-open-cart',content_block:'#cart-content-purchases',header_block:'#header-cart-content-purchases',footer_block:'#footer-cart-content-purchases',rollup_button:'#rollup-cart-content-purchases',rolldown_button:'#rolldown-cart-content-purchases',minimized:'#minimized-cart-block',maximized:null},max_window_width:null,min_window_width:null,hide_before_minimize:false},data:null,initialize:function(block_elem_selector,cart,options){this.parent(block_elem_selector,cart,options);cart.addEvent('update',this.onCartContentUpdated.bind(this));this.addEvent('miniBlockShow',function(){document.fireEvent("miniCartBlockShowed",{id:this.elem.id})}.bind(this))},init:function(){this.parent();if(this.elems.open_element){this.elems.open_element.addEvent('click',this.onClickOpenCart.bind(this))}document.fireEvent('updateSellerInfoHandlers')},onClickOpenCart:function(event){new Event(event).stop();this.data.openCart();document.fireEvent('cartBlockOpenPopUpCart')},onCartContentUpdated:function(){if(!this.data.getQuantity()){this.hide()}else{this.init()}},_prepareData:function(data){if(data&&data.S){for(var i in data.S.purchases){GTMEventsData.setGoodsData(data.S.purchases[i.toInt()].goods.id,data.getConvertDataToGTMFormat(data.S.purchases[i.toInt()].goods))}}return data}});var RozetkaMiniWaitlistAvailableBlock_class=RozetkaMiniBlock_class.extend({options:{template:'{if goods.length > 0} <section class=\"center-waitlist-wrap\" id=\"waitlist-available-mini-block\"> <div class=\"hidden\" id=\"minimized-waitlist-available-block\"> <div class=\"center-waitlist-folded clearfix\" id=\"waitlist-available-mini-rolldown-content\"> <div class=\"center-waitlist-folded-amount\"> <span class=\"center-waitlist-folded-amount-text\">\u0423\u0436\u0435 \u0432 \u043f\u0440\u043e\u0434\u0430\u0436\u0435<\/span> <a href=\"#\" class=\"center-waitlist-folded-amount-link sprite-side novisited\"> {var goods_word = [\u0027\u0442\u043e\u0432\u0430\u0440\u0027, \u0027\u0442\u043e\u0432\u0430\u0440\u0430\u0027, \u0027\u0442\u043e\u0432\u0430\u0440\u043e\u0432\u0027]} {var plural_form = plural(goods.length)} <span class=\"xhr\">${goods.length} ${goods_word[plural_form]} \u0438\u0437 \u043b\u0438\u0441\u0442\u0430 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f<\/span> <\/a> <\/div> <figure class=\"center-waitlist-folded-g-img clearfix\"> {for goods_item in goods} {var image = goods_item.attachments.images[0]} {var variant = image[\u0027small\u0027] ? \u0027small\u0027 : \u0027preview\u0027} <span class=\"responsive-img side-cart-folded-g-img-link\"> <img src=\"${image[variant].url}\" \/> <\/span> {\/for} <\/figure> <\/div> <\/div> <div class=\"center-waitlist-unfolded\" id=\"maximized-waitlist-available-block\"> <div id=\u0027waitlist-available-mini-rollup-content\u0027> <header class=\"center-waitlist-header\" id=\"waitlist-available-mini-header-content\"> <h3 class=\"center-waitlist-header-title\">\u0423\u0436\u0435 \u0432 \u043f\u0440\u043e\u0434\u0430\u0436\u0435 \u0442\u043e\u0432\u0430\u0440\u044b \u0438\u0437 \u043b\u0438\u0441\u0442\u0430 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f<\/h3> <span class=\"center-waitlist-header-toggle-link center\"> <img width=\"30\" height=\"31\" src=\"http:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c\" title=\"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c\" class=\"center-waitlist-header-toggle-link-img sprite\"> <\/span> <\/header> <\/div> <div id=\"waitlist-available-mini-center-content\"> <div class=\"center-waitlist-main-wrap\" id=\"waitlist-available-mini-content\"> <div class=\"center-waitlist-main\"> {var position = 0} {for goods_item in goods} {var position = position + 1} ${GTMEventsData.setGoodsData(goods_item.id, goods_item)} {var image = goods_item.attachments.images[0]} {var variant = image[\u0027medium\u0027] ? \u0027medium\u0027 : \u0027preview\u0027} <div class=\"center-waitlist-g-i\" id=\"catalog_item${goods_item.id}\" data-location=\"waitlistAvailable\" data-position=\"${position}\"> <a class=\"center-waitlist-g-i-img responsive-img\" href=\"${goods_item.href}\" onclick=\"document.fireEvent(\u0027waitlistAvailableGoodsTitleClick\u0027, {extend_event: [{name: \u0027goods_id\u0027, value: ${goods_item.id}}, {name: \u0027eventContext\u0027, value: \u0027photo\u0027}, {name: \u0027eventPosition\u0027, value: ${position}}]})\" > <img src=\"${image[variant].url}\" \/> <\/a> <div class=\"clearfix center-waitlist-g-i-content\"> <a href=\"${goods_item.href}\" class=\"g-title center-waitlist-g-title novisited\" onclick=\"document.fireEvent(\u0027waitlistAvailableGoodsTitleClick\u0027, {extend_event: [{name: \u0027goods_id\u0027, value: ${goods_item.id}}, {name: \u0027eventContext\u0027, value: \u0027title\u0027}, {name: \u0027eventPosition\u0027, value: ${position}}]})\" > ${goods_item.title} <\/a> <div class=\"clearfix center-waitlist-g-i-price\"> <span class=\"center-waitlist-uah\"> ${goods_item.price.primary.string} <\/span> <div name=\"buy_catalog\" class=\"center-waitlist-g-i-btn-wrap\"><\/div> <div name=\"seller_block\" seller_id=\"${goods_item.seller.id}\" popup_layout=\"bottom\" class=\"center-waitlist-g-i-merchant\"> <span class=\"side-cart-g-i-merchant-text\">\u041f\u0440\u043e\u0434\u0430\u0432\u0435\u0446<\/span> {if goods_item.seller && goods_item.seller.has_docket} <a href=\"#\" class=\"side-cart-g-i-merchant-link\" name=\"show_seller_info\"><span class=\"xhr\">${goods_item.seller.title}<\/span><\/a> {else} <span class=\"side-cart-g-i-merchant-link\">${goods_item.seller.title}<\/span> {\/if} <\/div> <\/div> <\/div> <\/div> {\/for} <\/div> <\/div> <footer class=\"center-waitlist-footer clearfix\" id=\"waitlist-available-mini-footer-content\"> <a class=\"center-waitlist-footer-to-cart novisited\" href=\"https:\/\/my.rozetka.com.ua\/profile\/waitlist\/\" id=\u0027waitlist-available-mini-block-open\u0027 onclick=\"document.fireEvent(\u0027waitlistAvailableToWaitlistClick\u0027)\" > \u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043b\u0438\u0441\u0442 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f <\/a> <\/footer> <\/div> <\/div> <\/section> {\/if}',save_state:{key_name:'mini_waitlist_available_block_state'},selectors:{mini_block:'#waitlist-available-mini-block',open_element:'#waitlist-available-mini-block-open',content_block:'#waitlist-available-mini-content',header_block:'#waitlist-available-mini-header-content',footer_block:'#waitlist-available-mini-footer-content',rollup_button:'#waitlist-available-mini-rollup-content',rolldown_button:'#waitlist-available-mini-rolldown-content',minimized:'#minimized-waitlist-available-block',maximized:null,slidable_element:'#waitlist-available-mini-center-content'},max_window_width:null,min_window_width:null,hide_before_minimize:false,goods_atp_statuses:['call','limited','available'],wait_statuses:['wait_flow']},_goods_catalog:null,_registered_catalog_items:[],data:null,initialize:function(block_elem_selector,waitlist,options){this.parent(block_elem_selector,waitlist,options);this._goods_catalog=window['GoodsCatalog'];if(!this._goods_catalog){throw new Error('Не удалось получить объект каталога товаров')}waitlist.addEvent('update',this.onWaitlistUpdated.bind(this));if(typeof Cart!=='undefifned'){Cart.addEvent('update',this.onCartContentUpdated.bind(this))}},init:function(){this.parent();this._registered_catalog_items.forEach(function(catalog_item){catalog_item.delete()});this._registered_catalog_items=[];this._getData().goods.forEach(function(goods_item){this._registered_catalog_items.push(this._goods_catalog.add(goods_item.id,'waitlist_available'))}.bind(this));$(document).fireEvent('updateSellerInfoHandlers')},onWaitlistUpdated:function(){this.init()},onCartContentUpdated:function(){this.init();if(this._registered_catalog_items==0){this.hide()}else{this.show()}},_prepareData:function(waitlist){var result={goods:[]};if(waitlist.data&&waitlist.data.length){result.goods=Array.map(Array.filter(waitlist.data,function(waitlist_record){var goods_data=waitlist_record.goods;return goods_data&&!parseInt(waitlist_record.goods_purchased)&&goods_data.sell_status&&this.options.goods_atp_statuses.indexOf(goods_data.sell_status)>-1&&this.options.wait_statuses.indexOf(waitlist_record.wait_status)>-1&&!Cart.inPurchases(goods_data.id)}.bind(this)),function(waitlist_record){return waitlist_record.goods})}return result}});var RozetkaScrollTopButton_class=new Class({Class:'RozetkaScrollTopButton_class',options:{duration:400,opacity_range:300},_button:null,initialize:function(button){this._button=button},init:function(){window.addEvent('resize',function(e){this.update()}.bind(this));window.addEvent('scroll',function(e){this.update()}.bind(this));this._button.addEvent('click',function(e){new Event(e).stop();new Fx.Scroll(this.getBody()).setOptions({duration:this.options.duration}).toTop()}.bind(this));this.update()},getBody:function(){return document.documentElement.scrollTop?document.documentElement:document.body},update:function(){var scrolltop=this.getBody().scrollTop,clientheight=document.body.clientHeight;if(scrolltop>clientheight){var destination_top=(clientheight+this.options.opacity_range),current_point=(destination_top-scrolltop);if(current_point>0){var relative_scrolltop=(scrolltop-clientheight),opacity=(relative_scrolltop/(this.options.opacity_range/ 100)) /100;this._button.setOpacity(opacity)}else{this._button.setOpacity(1)}if(!this._button.isVisible()){this._button.show()}}else{this._button.hide()}}});RozetkaScrollTopButton_class.implement(new Events(),new Options());var GTMData_BaseProduct_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_BaseProduct_class',options:{GTM:{events:{openWishlistPopup:{event_name:'openWishlistPopup',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'popupWishlist'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},open_profile:{event_name:'clickOpenProfile',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openProfile'},{name:'eventLocation',value:'cart'}]},social:{event_name:'clickSocial',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'social'},{name:'eventLocation',value:'cart'}]},openCityPopup:{event_name:'clickToPopupCity',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'cityPopup'},{name:'eventLocation',value:'Head'}]},changeCity:{event_name:'changeCity',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'cityChoose'},{name:'eventLocation',value:'head'}]},check_service:{event_name:'checkService',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'service'},{name:'eventAction',value:'click'},{name:'eventContent',value:'check'}]},uncheck_service:{event_name:'uncheckService',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'service'},{name:'eventAction',value:'click'},{name:'eventContent',value:'uncheck'}]},add_to_comparison:{event_name:'clickAddToCompare',extend_event:[{name:'eventLabel',value:'addToCompare'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventContext',handlerID:'getProductCountComments'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},scroller:{event_name:'scrollerUse',extend_event:[{name:'eventAction',value:'scroll'}]},suggest:{event_name:'suggestShow',extend_event:[{name:'eventAction',value:'show'},{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'suggest'},{name:'eventNoninteraction',value:1}]},goods_title_click:{event_name:'goodsTitleClick',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openProductPage'},{name:'eventContext',value:'title'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventContent',handlerID:'getContent'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},goods_click_goods_in_other_offers_block:{event_name:'goodsOtherOffersGoodsClick',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openProductPage'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},goods_image_click:{event_name:'goodsImageClick',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openProductPage'},{name:'eventContext',value:'photo'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventContent',handlerID:'getContent'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},toggleVarDetailsDropDown:{event_name:'toggleVarDetailsDropDown',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLocation',value:'ProductPage'},{name:'eventLabel',value:'variantOpen'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},variant_image_click:{event_name:'variantImageClick',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLocation',value:'OtherColorPopUpCatalog'},{name:'eventLabel',value:'openProductPage'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventContext',value:'photo'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},to_checkout_from_head:{event_name:'goToCheckoutFromHead',extend_event:[{name:'eventLabel',value:'checkout'},{name:'eventLocation',value:'Head'}]},recent_save:{event_name:'clickSaveRecent',extend_event:[{name:'eventLabel',value:'saveRecentHistory'}]},show_recent:{event_name:'showAllRecentGoods',extend_event:[{name:'eventLabel',value:'openRecentHistory'}]},for_gift_in_cart:{event_name:'forGiftClick',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'forPresent'}]},open_category_search:{event_name:'openCategorySearch',extend_event:[{name:'eventLabel',value:'openCategory'},{name:'eventLocation',value:'SearchBar'}]},show_category_search:{event_name:'showCategorySearch',extend_event:[{name:'eventLabel',value:'showCategory'},{name:'eventAction',value:'show'},{name:'eventLocation',value:'SearchBar'}]},search_button:{event_name:'searchButton',extend_event:[{name:'eventLabel',value:'searchButton'},{name:'eventLocation',value:'searchResults'}]},comparison_header:{selector:'[id=comparison]',extend_event:[{name:'eventLabel',value:'comparison'}]},wishlist_header:{event_name:'clickWishlistHeader',extend_event:[{name:'eventLabel',value:'wishlist'}]},enter_profile:{event_name:'enterProfile',extend_event:[{name:'eventLabel',value:'enterProfile'},{name:'eventContext',value:'permanent'}]},choose_compare:{event_name:'chooseCompare',extend_event:[{name:'eventLabel',value:'chooseCompare'}]},profile_menu:{event_name:'profileMenu',extend_event:[{name:'eventLabel',value:'profileMenu'}]},profile:{event_name:'profile',extend_event:[{name:'eventLabel',value:'profile'}]},openBonusesPopup:{event_name:'openBonusesPopup',extend_event:[{name:'eventLabel',value:'openBonusesPopup'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'},{name:'eventNoninteraction',value:1}]},openFlashBonusesPopup:{event_name:'openFlashBonusesPopup',extend_event:[{name:'eventLabel',value:'flashBonuses'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLocation',value:'rozetkaClub ProductPage'}]},useBonuses:{event_name:'useBonuses',extend_event:[{name:'eventLabel',value:'useBonuses'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'}]},enterProfile:{event_name:'enterProfile',extend_event:[{name:'eventLabel',value:'enterProfile'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'}]},openRozetkaClubPage:{event_name:'openRozetkaClubPage',extend_event:[{name:'eventLabel',value:'openRozetkaClubPage'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'}]},wantConfirmPhone:{event_name:'wantConfirmPhone',extend_event:[{name:'eventLabel',value:'wantConfirmPhone'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'}]},registration:{event_name:'registration',extend_event:[{name:'eventLabel',value:'registration'},{name:'eventCategory',value:'Conversions'}]},remove:{event_name:'removeFromComparison',extend_event:[{name:'eventLabel',value:'product'},{name:'eventAction',value:'remove'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventLocation',value:'compare'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},closeAuthPopup:{event_name:'closeAuthPopup',extend_event:[{name:'eventLabel',value:'closeAuthPopup'}]},social_signup_success:{event_name:'social_signup_success',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'signup'},{name:'eventLabel',value:'social'}]},more20productCompare:{event_name:'more20productCompare',extend_event:[{name:'eventLabel',value:'more20productCompare'},{name:'eventAction',value:'show'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'}]},carousel_scroll:{event_name:'carousel_scroll',extend_event:[{name:'eventLabel',value:'kit'},{name:'eventAction',value:'scroll'},{name:'eventLocation',value:'ProductPage'},{name:'eventContent',value:'complement'}]},productsImpressions:{event_name:'productsImpressions',extend_event:[{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'},{name:'eventLabel',value:'goods'}]},track_order:{event_name:'trackOrder',extend_event:[{name:'eventLabel',value:'trackOrder'},{name:'eventLocation',value:'head'}]},registrationSuccess:{event_name:'registrationSuccess',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'signup'},{name:'eventLabel',value:'registrationSuccess'}]},sellThisProductClick:{event_name:'sellThisProductClick',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'sellThisProduct'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getAuthorizedUserSellerId'}]},choose_language:{event_name:'languageChoose',extend_event:[{name:'eventLabel',value:'languageChoose'},{name:'eventLocation',value:'Head'}]}}}},base_GTM_event:{eventCategory:'Interactions',eventAction:'click'},storage:null,initialize:function(events_storage_object,options){this.storage=events_storage_object;if(options!==undefined){this.setOptions(options)}if(this.options.additional.base_GTM_event){Object.merge(this.base_GTM_event,this.options.additional.base_GTM_event)}},getProductId:function(id){return parseInt(id,10)},getProductPrice:function(id,type){return this._getPrice(id,type,'price_usd')},getProductRawPrice:function(id,type){var price=this._getPrice(id,type,'price_usd_raw');return(price==null)?this.getProductPrice(id,type):price},getProductSource:function(id,type){var result=this.storage.getGoodsDataField(id,'source',type);return result},getProductTag:function(id,type){return this.storage.getGoodsDataField(id,'tag',type)},getProductTitle:function(id,type){return this.storage.getGoodsDataField(id,'title',type)},getProductCategoryId:function(id,type){var result=this.storage.getGoodsDataField(id,'parent_id',type);if(result){result=parseInt(result,10)}return result},getProducerId:function(id,type){var result=this.storage.getGoodsDataField(id,'producer_id',type);if(result){result=parseInt(result,10)}return result},getProductCondition:function(id,type){return this.storage.getGoodsDataField(id,'state',type)},getProductGroupContextByState:function(id,type){return this.storage.getGoodsDataField(id,'state_group_context',type)},getTopParentId:function(id,type){var result=this.storage.getGoodsDataField(id,'top_parent_id',type);if(result){result=parseInt(result,10)}return result},getPosition:function(id){var position=$E('[name=position_number'+id+']')||$E('[name=slider_pos_number'+id+']'),result=null;if(position&&position.value){result=parseInt(position.value,10)}return result},getTitle:function(e){var target=(e.target||e.srcElement);return target.getText().trim()},getProductCategoryName:function(id,type){return this.storage.getGoodsDataField(id,'parent',type)},getProductCountComments:function(id,type){return this.storage.getGoodsDataField(id,'count_comments',type)},getKitProducts:function(e){var products=[],ids=[],position=1,object,bug_names=['productCategoryId','productCategoryGroupId'],addIds=function(iterable){Object.each(iterable,function(elem){if('object'==typeof elem){addIds(elem)}else if(elem&&parseInt(elem,10)){ids.push(elem)}})};if(e.goods_ids){addIds(e.goods_ids);ids.each(function(id){object={productId:this.getProductId(id),productName:this.getProductTitle(id),productVendorId:this.getProducerId(id),productQuantity:1,position:position++,productMerchantId:this.getMerchantId(id),productSellerId:this.getSellerId(id)};object[bug_names[0]]=this.getProductCategoryId(id);object[bug_names[1]]=this.getTopParentId(id);if(this.getProductRawPrice(id)){object.productPrice=this.getProductRawPrice(id)}products.push(object)}.bind(this))}return products},getContent:function(goods_id){var result=null,content=$$('[name=content_gtm'+goods_id+']')[0];if(content&&content.value){result=content.value}return result},getContext:function(){return User.isAuth()?'existingUser':'newUser'},getSellerId:function(id,type){var result=this.storage.getGoodsDataField(id,'seller_id',type);if(result){result=parseInt(result,10)}return result},getPLEventLocation:function(){var service=App.getService('ProgramLoyalty'),pl_data=null,result;if(service){pl_data=service.getData();result=pl_data['is_header']?'rozetkaClub Head':'rozetkaClub ProductPage'}return result},getUserPLStatus:function(){var service=App.getService('ProgramLoyalty'),result='notAuthorized',pl_data=null;if(service&&User.isAuth()){pl_data=service.getData();if(pl_data){result='Unconfirm';if(pl_data.loyalty_accepted){result=!pl_data.exist_phone?'Unverified':'Active'}}}return result},getMerchantId:function(id,type){var result=this.storage.getGoodsDataField(id,'merchant_id',type);if(result){result=parseInt(result,10)}return result},_getCurrentTargetData:function(data_name){var event=new Event();return event&&event.event.currentTarget&&event.event.currentTarget.data(data_name)},_getPrice:function(id,type,price_field){var result=this.storage.getGoodsDataField(id,price_field,type);if(result){result=parseFloat(result)}return result},getAuthorizedUserSellerId:function(){var seller_id=null;if($defined(User)&&User.getProperty('seller_id')){seller_id=User.getProperty('seller_id')}return seller_id}});var GTMData_MainPage_class=GTMData_BaseProduct_class.extend({Class:'GTMData_MainPage_class',options:{GTM:{events:{click_main_category:{event_name:'menu_categories_click',extend_event:[{name:'eventLabel',value:'openCategory'},{name:'eventLocation',value:'popular'},{name:'eventContent',handler:'getCategoryTitle'}]},add_to_wishlist:{event_name:'clickToWishlist',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventLabel',value:'addToWishlist'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventContext',handlerID:'getProductCountComments'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},add_to_waitlist:{event_name:'addToWaitlist',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventLabel',value:'addToWaitlist'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventContext',handlerID:'getProductCountComments'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},add_to_comparison:{event_name:'clickAddToCompare',extend_event:[{name:'eventLabel',value:'addToCompare'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductСategoryId',handlerID:'getProductCategoryId'},{name:'eventProductСategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventContext',handlerID:'getProductCountComments'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},scroller:{event_name:'scrollerUse',extend_event:[{name:'eventAction',value:'scroll'}]},mini_cart_toggle:{event_name:'cartBlockToggle',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'cart'},{name:'eventContent',handler:'getToggleState'}]},mini_cart_open_popup_cart:{event_name:'cartBlockOpenPopUpCart',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'open'},{name:'eventLabel',value:'cart'},{name:'eventLocation',value:'smallCart'}]},tab_click:{event_name:'tab_on_main',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'tab'},{name:'eventContent',handler:'getDataTitle'}]},promotion_click:{event_name:'promotion_click',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'promotion'},{name:'eventContent',handler:'getDataTitle'}]},news_articles:{event_name:'news_articles_click',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'newsArticles'},{name:'eventContent',handler:'getDataTitle'}]},comments_link_click:{event_name:'comments_link_click',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'reviews'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryName',handlerID:'getProductCategoryName'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},scroller_slide:{event_name:'scroller_slide',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'slide'},{name:'eventLabel',value:'goods'}]},productsRecommendsImpressions:{event_name:'productsRecommendsImpressions',extend_event:[{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'},{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'Main'}]},rg_load:{event_name:'recentGoodsViewed',extend_event:[{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'},{name:'eventLabel',value:'goods'}]},goods_blocked_showed:{event_name:'goodsBlockViewed',extend_event:[{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'},{name:'eventLabel',value:'goods'}]},waitlist_available_block:{event_name:'initWaitlistAvailable',extend_event:[{name:'eventAction',value:'show'},{name:'eventCategory',value:'Non-Interactions'},{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'Main'},{name:'products',handler:'getWaitlistProducts'}]},waitlist_available_goods_title_click:{event_name:'waitlistAvailableGoodsTitleClick',extend_event:[{name:'eventAction',value:'click'},{name:'eventCategory',value:'Interactions'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventSellerId',handlerID:'getSellerId'},{name:'eventLabel',value:'openProductPage'},{name:'eventLocation',value:'waitlistAvailable'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventMerchantId',handlerID:'getMerchantId'}]},go_to_waitlist:{event_name:'waitlistAvailableToWaitlistClick',extend_event:[{name:'eventAction',value:'click'},{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'waitlist'},{name:'eventLocation',value:'waitlistAvailable'}]}}}},base_GTM_event:{eventLocation:'Main'},getWaitlistProducts:function(goods){var result=[];Array.each(goods,function(item,position){result.push({eventProductCategoryId:item.parent_id,productID:item.id,productLocation:'waitlistAvailable',productMerchantID:item.merchant_id,productName:item.title,productPosition:++position,productPrice:item.price.primary.raw,productSellerID:item.seller.id,productVendorID:item.producer_id})});return result},getCategoryTitle:function(e){return this._getEventTargetText(e)},getToggleState:function(event){return event.state},getDataTitle:function(e){var event=new Event(e),target=event.event.currentTarget||event.target,attribute=this._getDataTitleAttribute(target),result;if(target&&target.getAttribute(attribute)){result=target.getAttribute(attribute)}if(!result){result=this._getEventTargetText(e)}return result}});